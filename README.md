# HJY Mon
A project to monitor part of a web page. For example, monitor a list of news. This is the node js backend to provide RESTful API. The frontend is created by ionic in
[HJYMon-Ionic](https://github.com/ngjaying/HJYMon-Ionic).

## APIs

First, you will need to install and run [MongoDB](https://www.mongodb.com/) in another terminal instance.

```bash
$ mongod
```
Then, update .evn file with your keys. Then, run the server in development mode.

```bash
$ npm run dev
Express server listening on http://0.0.0.0:9000, in development mode
```

### Create a user (sign up):
```bash
curl -X POST http://0.0.0.0:9000/users -i -d "email=test@example.com&password=123456&access_token=MASTER_KEY_HERE"
```
It will return something like:
```bash
HTTP/1.1 201 Created
...
{
  "id": "57d8160eabfa186c7887a8d3",
  "name": "test",
  "picture":"https://gravatar.com/avatar/55502f40dc8b7c769880b10874abc9d0?d=identicon",
  "email": "test@example.com",
  "createdAt": "2016-09-13T15:06:54.633Z"
}
```

### Authenticate the user (sign in):
```bash
curl -X POST http://0.0.0.0:9000/auth -i -u test@example.com:123456 -d "access_token=MASTER_KEY_HERE"
```

It will return something like:
```bash
HTTP/1.1 201 Created
...
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
  "user": {
    "id": "57d8160eabfa186c7887a8d3",
    "name": "test",
    "picture": "https://gravatar.com/avatar/55502f40dc8b7c769880b10874abc9d0?d=identicon",
    "email": "test@example.com",
    "createdAt":"2016-09-13T15:06:54.633Z"
  }
}
```

Now you can use the `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9` token (it's usually greater than this) to call user protected APIs.

### launchies
Get all launchies for the current user
```bash
Get http://localhost:9000/launchies?access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU4YWZjY2I1MGYyODZhM2JhYWMzMmRkNiIsImlhdCI6MTQ4NzkyMTkzMn0.WI1Z8AWTe3J8JRaGgu2J2i4qiT-Xt3FuMm5PjFk36I0
```

It will return something like:
```bash
HTTP/1.1 200 OK
...
[
  {
    "id": "58afce120f286a3baac32dd8",
    "user": {
    "id": "58afccb50f286a3baac32dd6"
    },
    "monitor": {
    "id": "58afce120f286a3baac32dd7",
    "url": "yoururl",
    "jqpath": "form[name=formRight] table:nth-of-type(5) td a",
    "value": "value",
    "launchies": [
      "58afce120f286a3baac32dd8"
    ],
    },
    "createdAt": "2017-02-24T06:09:22.578Z",
    "updatedAt": "2017-02-24T06:09:22.578Z"
    }
],
```

Add new launchy
```bash
Post http://localhost:9000/launchies?access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU4YWZjY2I1MGYyODZhM2JhYWMzMmRkNiIsImlhdCI6MTQ4NzkyMTkzMn0.WI1Z8AWTe3J8JRaGgu2J2i4qiT-Xt3FuMm5PjFk36I0

Payload
url=http%3A%2F%2Fwww.baidu.com&jqpath=div%3Ediv
```

It will return something like:
```bash
HTTP/1.1 200 OK
...
{
  "__v": 1,
  "updatedAt": "2017-02-24T09:33:04.970Z",
  "createdAt": "2017-02-24T09:33:04.959Z",
  "url": "http://www.baidu.com",
  "jqpath": "div>div",
  "_id": "58affdd00f286a3baac32ddc",
  "launchies": [
    "58affdd00f286a3baac32ddd"
  ],
}
```



## Powered by
A RESTful API generated by [generator-rest](https://github.com/diegohaz/generator-rest).

See the API's [documentation](DOCS.md).
